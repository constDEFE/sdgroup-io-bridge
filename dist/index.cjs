"use strict";var X=Object.create;var f=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var H=Object.getPrototypeOf,G=Object.prototype.hasOwnProperty;var V=(o,t)=>{for(var e in t)f(o,e,{get:t[e],enumerable:!0})},K=(o,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of F(t))!G.call(o,n)&&n!==e&&f(o,n,{get:()=>t[n],enumerable:!(r=j(t,n))||r.enumerable});return o};var U=(o,t,e)=>(e=o!=null?X(H(o)):{},K(t||!o||!o.__esModule?f(e,"default",{value:o,enumerable:!0}):e,o)),z=o=>K(f({},"__esModule",{value:!0}),o);var i=(o,t,e)=>new Promise((r,n)=>{var s=u=>{try{m(e.next(u))}catch($){n($)}},p=u=>{try{m(e.throw(u))}catch($){n($)}},m=u=>u.done?r(u.value):Promise.resolve(u.value).then(s,p);m((e=e.apply(o,t)).next())});var J={};V(J,{AmountTransform:()=>L,ApplicationService:()=>b,AuthService:()=>C,BridgeService:()=>I,CallerType:()=>l,ConverterService:()=>S,FeeService:()=>T,HeadersEnum:()=>g,NetworkService:()=>B,NetworkType:()=>h,OfferService:()=>E,PaymentStatus:()=>M,PaymentWebhookStatus:()=>R,PaymentsService:()=>k,Service:()=>a,TokenService:()=>v,TokenType:()=>_,WalletBalanceService:()=>O,WalletService:()=>N,default:()=>d,useBridgeState:()=>Y,useDestroy:()=>P});module.exports=z(J);var W=U(require("axios"),1),y=require("rxjs");var _=(n=>(n.NATIVE="NATIVE",n.ERC20="ERC20",n.BEP20="BEP20",n.TRC20="TRC20",n))(_||{}),l=(e=>(e.APPLICATION="APPLICATION",e.USER="USER",e))(l||{}),g=(t=>(t.X_CALLER_TYPE="X-Caller-Type",t))(g||{}),R=(r=>(r.SENDING="SENDING",r.FAILURE="FAILURE",r.SUCCESS="SUCCESS",r))(R||{}),M=(e=>(e.AWAITING_PAYMENT="AWAITING_PAYMENT",e.PAID="PAID",e))(M||{}),h=(r=>(r.BITCOIN="BITCOIN",r.ETHEREUM_COMPATIBLE="ETHEREUM_COMPATIBLE",r.TRON_COMPATIBLE="TRON_COMPATIBLE",r))(h||{});var d=class{constructor(t={}){this.config=t;this.instanceServices=new Map;this.application$=new y.BehaviorSubject(void 0);var e,r;this.http=W.default.create(),this.storage=(e=this.config.storage)!=null?e:localStorage,this.config.storageKeysPrefix=(r=this.config.storageKeysPrefix)!=null?r:"bridge",this.http.interceptors.request.use(n=>{let s=this.storage.getItem(`${this.config.storageKeysPrefix}_token`);if(n.headers.set("Authorization",`Bearer ${s}`),n.headers.get("X-Caller-Type")==="APPLICATION"){let p=this.application$.getValue();p&&(n.auth={username:p.authId,password:p.secretKey})}return n})}getService(t){return this.instanceServices.has(t)?this.instanceServices.get(t):(this.instanceServices.set(t,new t(this.http,this.storage,this.config)),this.getService(t))}useApplication(t){return this.application$.next(t),this}getSelectedApplication$(){return this.application$.pipe((0,y.filter)(t=>!!t))}};var x=require("rxjs"),q=require("react"),P=()=>{let o=new x.Subject;return(0,q.useEffect)(()=>()=>o.next(!0),[]),{untilDestroy:()=>t=>t.pipe((0,x.takeUntil)(o))}};var A=require("react"),w=require("rxjs");var Y=(o,t,e,r=[])=>{let[n,s]=(0,A.useState)(e),{untilDestroy:p}=P();return(0,A.useEffect)(()=>{(0,w.merge)(o.getSelectedApplication$()).pipe(p(),(0,w.switchMap)(m=>i(void 0,null,function*(){return yield t({app:m})}))).subscribe(s)},r),[n,s]};var a=class{constructor(t,e,r){this.http=t;this.storage=e;this.config=r}};var b=class extends a{constructor(t,e,r){super(t,e,r)}create(t){return i(this,null,function*(){return yield this.http.post("/api/application").then(e=>e.data)})}getApplications(){return i(this,null,function*(){return yield this.http.get("/api/applications").then(t=>t.data)})}getMyApplications(){return i(this,null,function*(){return yield this.http.get("/api/my-applications").then(t=>t.data)})}exportPrivateKey(t){return i(this,null,function*(){return"secret key"})}resetPrivateKey(t){return i(this,null,function*(){})}};var C=class extends a{constructor(e,r,n){super(e,r,n);this.authMessage="Authentication"}loginViaMetamask(){return i(this,null,function*(){if("ethereum"in window){let e=window.ethereum,n=(yield e.request({method:"eth_requestAccounts"}))[0],s=yield e.request({method:"personal_sign",params:[this.authMessage,n]}),{token:p}=yield this.http.post("/api/auth/web3",{signature:s}).then(m=>m.data);return this.storage.setItem(`${this.config.storageKeysPrefix}_token`,p),{token:p}}throw new Error("WEB3 Provider not found")})}getAccounts(){return i(this,null,function*(){return yield this.http.get("/api/auth/accounts").then(e=>e.data)})}login(e,r){return i(this,null,function*(){let{token:n}=yield this.http.post("/api/auth/login",{login:e,password:r}).then(s=>s.data);return this.storage.setItem(`${this.config.storageKeysPrefix}_token`,n),n})}isAuth(){return i(this,null,function*(){return(this.storage.getItem(`${this.config.storageKeysPrefix}_token`)||"").split(".").length===3})}logout(){return i(this,null,function*(){this.storage.removeItem(`${this.config.storageKeysPrefix}_token`)})}};var I=class extends a{getBalance(t,e,r){return i(this,null,function*(){return yield this.http.get(`/api/bridge/${t}/${e}/wallet/${r}/balance`,{headers:{["X-Caller-Type"]:"APPLICATION"}}).then(n=>n.data)})}transfer(t){return i(this,null,function*(){return yield this.http.post(`/api/bridge/${t.network}/${t.symbol}/transfer`,{from:t.from,to:t.to,amount:t.amount},{headers:{["X-Caller-Type"]:"APPLICATION"}}).then(e=>e.data)})}};var S=class extends a{constructor(t,e,r){super(t,e,r)}convert(t){return i(this,null,function*(){let e=`/api/converter/${t.from}/${t.fromDecimals}/${t.amountScaled}/${t.to}/${t.toDecimals}`;return yield this.http.get(e).then(r=>r.data)})}};var T=class{getFee(){return i(this,null,function*(){return{rate:1.1}})}};var B=class{constructor(t){this.http=t}getNetworkByCode(t){return i(this,null,function*(){let r=(yield this.getNetworks()).find(n=>n.code===t);if(!r)throw new Error(`Network ${t} not found`);return r})}getNetworks(){return i(this,null,function*(){return yield this.http.get("/api/networks",{headers:{"content-type":"application/json"}}).then(t=>t.data)})}create(t){return i(this,null,function*(){let e={name:t.name,code:t.code,kind:t.kind,url:t.url,apiKey:"",username:"",password:""};return t.kind==="TRON_COMPATIBLE"&&(e.apiKey=t.apiKey),yield this.http.post("/api/network",e)})}delete(t){return i(this,null,function*(){yield this.http.delete(`/api/network/${t}`)})}};var E=class extends a{constructor(t,e,r){super(t,e,r)}getOffers(){return i(this,null,function*(){return yield this.http.get("/api/offers").then(t=>t.data)})}};var k=class extends a{getPayments(){return i(this,null,function*(){return yield this.http.get("/api/payments",{headers:{["X-Caller-Type"]:"APPLICATION"}}).then(t=>t.data)})}getPaymentById(t){return i(this,null,function*(){return yield this.http.get(`/api/payment/${t}`).then(e=>e.data)})}createPayment(t){return i(this,null,function*(){return yield this.http.post("/api/payment",t,{headers:{["X-Caller-Type"]:"APPLICATION"}}).then(e=>e.data)})}manualPay(t,e){return i(this,null,function*(){return yield this.http.post(`/api/payment/${t}/pay`,e).then(r=>r.data)})}};var c=require("rxjs");var v=class{constructor(t){this.http=t;this.$tokenStream=(0,c.defer)(()=>(0,c.from)(this.getTokens())).pipe((0,c.share)(),(0,c.throttleTime)(1e4))}getTokensBySymbol(t,e){return i(this,null,function*(){let n=(yield this.getTokens()).find(s=>e?s.symbol===t&&s.network.code===e:s.symbol===t);if(!n)throw new Error(`Token ${t}[${e!=null?e:""}] not found`);return n})}getTokens(){return i(this,null,function*(){return yield this.http.get("/api/tokens").then(t=>t.data)})}create(t){return i(this,null,function*(){return yield this.http.post("/api/token",t).then(e=>e.data)})}delete(t){return i(this,null,function*(){yield this.http.delete(`/api/token/${t}`)})}};var O=class extends a{constructor(t,e,r){super(t,e,r)}getWalletsWithBalances(){return i(this,arguments,function*(t={}){let e=new URLSearchParams;return t.owners&&t.owners.length&&e.set("owners",t.owners.join(",")),yield this.http.get("/api/wallet-balances",{params:e}).then(r=>r.data)})}};var N=class extends a{constructor(t,e,r){super(t,e,r)}getWallets(){return i(this,arguments,function*(t={}){let e=new URLSearchParams;return t.owners&&t.owners.length&&e.set("owners",t.owners.join(",")),yield this.http.get("/api/bridge/wallets",{params:e}).then(r=>r.data)})}};var D=U(require("bignumber.js"),1),L=class{static fromCents(t,e=8,r=e){return new D.default(Number(t)).dividedBy(10**e).toFixed(r)}static toCents(t,e=8){return new D.default(Number(t)).multipliedBy(10**e).toFixed(0)}};0&&(module.exports={AmountTransform,ApplicationService,AuthService,BridgeService,CallerType,ConverterService,FeeService,HeadersEnum,NetworkService,NetworkType,OfferService,PaymentStatus,PaymentWebhookStatus,PaymentsService,Service,TokenService,TokenType,WalletBalanceService,WalletService,useBridgeState,useDestroy});
//# sourceMappingURL=index.cjs.map